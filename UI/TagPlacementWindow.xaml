<Window
    x:Class="SmartTags.UI.TagPlacementWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:av="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="clr-namespace:SmartTags.UI"
    Title="Smart Tags"
    Width="540"
    MinWidth="520"
    MinHeight="400"
    AllowsTransparency="True"
    Background="Transparent"
    Opacity="0"
    SizeToContent="Height"
    WindowStyle="None"
    mc:Ignorable="av">
    <Window.Style>
        <Style TargetType="Window">
            <Setter Property="Height" Value="Auto" />
            <Style.Triggers>
                <EventTrigger RoutedEvent="Window.SizeChanged">
                    <BeginStoryboard>
                        <Storyboard>
                            <DoubleAnimation
                                Storyboard.TargetProperty="Height"
                                Duration="0:0:0.2"
                                DecelerationRatio="0.6">
                                <DoubleAnimation.EasingFunction>
                                    <CubicEase EasingMode="EaseOut" />
                                </DoubleAnimation.EasingFunction>
                            </DoubleAnimation>
                        </Storyboard>
                    </BeginStoryboard>
                </EventTrigger>
            </Style.Triggers>
        </Style>
    </Window.Style>
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary>
                    <SolidColorBrush x:Key="PrimaryBackgroundBrush" Color="#FF1F1F1F" />
                    <SolidColorBrush x:Key="SecondaryBackgroundBrush" Color="#FF292929" />
                    <SolidColorBrush x:Key="BorderBrush" Color="#FF444444" />
                    <SolidColorBrush x:Key="ForegroundBrush" Color="#EEEEEE" />
                </ResourceDictionary>
                <ResourceDictionary Source="pack://application:,,,/MaterialDesignThemes.Wpf;component/Themes/MaterialDesignTheme.ComboBox.xaml" />
                <ResourceDictionary Source="pack://application:,,,/MaterialDesignThemes.Wpf;component/Themes/MaterialDesignTheme.Dark.xaml" />
                <ResourceDictionary Source="pack://application:,,,/SmartTags;component/UI/Themes/ElementStyles.xaml" />
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </Window.Resources>

    <Grid Background="Transparent" ClipToBounds="True">
        <Border
            BorderBrush="{DynamicResource BorderBrush}"
            BorderThickness="2"
            ClipToBounds="True"
            CornerRadius="10"
            Opacity="0.7"
            SnapsToDevicePixels="True">
            <Border.Effect>
                <BlurEffect KernelType="Gaussian" Radius="2" />
            </Border.Effect>
        </Border>

        <Border
            Margin="2"
            Background="{DynamicResource PrimaryBackgroundBrush}"
            CornerRadius="10">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="30" />
                    <RowDefinition Height="Auto" />
                </Grid.RowDefinitions>

                <ui:TitleBar
                    Grid.Row="0"
                    Foreground="{DynamicResource ForegroundBrush}"
                    Loaded="TitleBar_Loaded" />

                <ToggleButton
                    x:Name="ThemeToggleButton"
                    Grid.Row="0"
                    Width="28"
                    Height="15.5"
                    Margin="0,0,70,0"
                    HorizontalAlignment="Right"
                    Background="Transparent"
                    BorderBrush="Transparent"
                    Click="ToggleTheme_Click"
                    IsChecked="True"
                    ToolTip="Toggle Theme">
                    <ToggleButton.Template>
                        <ControlTemplate TargetType="{x:Type ToggleButton}">
                            <Grid Background="Transparent">
                                <materialDesign:PackIcon
                                    x:Name="ThemeToggleIcon"
                                    Width="30"
                                    Height="30"
                                    HorizontalAlignment="Center"
                                    VerticalAlignment="Center"
                                    Foreground="{DynamicResource IconBrush}"
                                    Kind="ToggleSwitchOffOutline" />
                            </Grid>
                            <ControlTemplate.Triggers>
                                <Trigger Property="IsChecked" Value="True">
                                    <Setter TargetName="ThemeToggleIcon" Property="Kind" Value="ToggleSwitchOffOutline" />
                                </Trigger>
                                <Trigger Property="IsChecked" Value="False">
                                    <Setter TargetName="ThemeToggleIcon" Property="Kind" Value="ToggleSwitchOutline" />
                                </Trigger>
                            </ControlTemplate.Triggers>
                        </ControlTemplate>
                    </ToggleButton.Template>
                </ToggleButton>

                <Grid Grid.Row="1" Margin="12,12,12,6">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>

                    <!--  Preset Selection Row  -->
                    <Grid Grid.Row="0" Margin="2,0,0,10">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition Width="*" />
                        </Grid.ColumnDefinitions>
                        <TextBlock
                            Grid.Column="0"
                            Margin="0,0,10,0"
                            VerticalAlignment="Center"
                            FontSize="12"
                            Foreground="{DynamicResource ForegroundBrush}"
                            Text="Preset" />
                        <ComboBox
                            Grid.Column="1"
                            Height="32"
                            Style="{StaticResource DarkThemeComboBox}">
                            <ComboBoxItem Content="&lt; No Preset &gt;" IsSelected="True" />
                        </ComboBox>
                    </Grid>

                    <!--  Scrollable Content Area  -->
                    <ScrollViewer
                        Grid.Row="1"
                        MaxHeight="1500"
                        HorizontalScrollBarVisibility="Disabled"
                        PreviewMouseDown="Background_PreviewMouseDown"
                        VerticalScrollBarVisibility="Auto">
                        <StackPanel Margin="0,0,0,0">
                            <!--  Tag Selection Card  -->
                            <Expander
                                x:Name="TagSelectionExpander"
                                Collapsed="CardExpander_Toggled"
                                Expanded="CardExpander_Toggled"
                                Header="Tag Selection"
                                IsExpanded="True"
                                Style="{StaticResource CollapsibleCardExpander}">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="150" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>

                                    <TextBlock
                                        Grid.Row="0"
                                        Grid.Column="0"
                                        Margin="0,0,10,8"
                                        Style="{StaticResource CustomTextBlock}"
                                        Text="Element category" />
                                    <ComboBox
                                        x:Name="CategoryComboBox"
                                        Grid.Row="0"
                                        Grid.Column="1"
                                        Margin="0,0,0,8"
                                        DisplayMemberPath="DisplayName"
                                        ItemsSource="{Binding TagCategories}"
                                        SelectionChanged="CategoryComboBox_SelectionChanged"
                                        Style="{StaticResource DarkThemeComboBox}" />

                                    <TextBlock
                                        Grid.Row="1"
                                        Grid.Column="0"
                                        Margin="0,0,10,8"
                                        Style="{StaticResource CustomTextBlock}"
                                        Text="Tag family + type" />
                                    <ComboBox
                                        x:Name="TagTypeComboBox"
                                        Grid.Row="1"
                                        Grid.Column="1"
                                        Margin="0,0,0,8"
                                        DisplayMemberPath="DisplayName"
                                        ItemsSource="{Binding TagTypes}"
                                        Style="{StaticResource DarkThemeComboBox}" />

                                    <CheckBox
                                        x:Name="IncludeLinksCheckBox"
                                        Grid.Row="2"
                                        Grid.Column="0"
                                        Grid.ColumnSpan="2"
                                        Content="Include elements from links"
                                        IsChecked="False"
                                        Style="{StaticResource CustomCheckboxStyle}">
                                        <CheckBox.LayoutTransform>
                                            <ScaleTransform ScaleX="0.85" ScaleY="0.85" />
                                        </CheckBox.LayoutTransform>
                                    </CheckBox>
                                </Grid>
                            </Expander>

                            <!--  Direction Tag Override Card  -->
                            <Expander
                                x:Name="DirectionTagOverrideExpander"
                                Collapsed="CardExpander_Toggled"
                                Expanded="CardExpander_Toggled"
                                Header="Direction Tag Override"
                                Style="{StaticResource CollapsibleCardExpander}">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="150" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>

                                    <TextBlock
                                        Grid.Row="0"
                                        Grid.Column="0"
                                        Margin="0,0,10,8"
                                        VerticalAlignment="Center"
                                        Style="{StaticResource CustomTextBlock}"
                                        Text="Keyword" />
                                    <TextBox
                                        x:Name="DirectionKeywordTextBox"
                                        Grid.Row="0"
                                        Grid.Column="1"
                                        Margin="0,0,8,8"
                                        HorizontalAlignment="Stretch"
                                        materialDesign:HintAssist.Hint="e.g. Tag"
                                        Style="{StaticResource CustomTextBoxStyle}"
                                        Text=""
                                        TextChanged="DirectionKeywordTextBox_TextChanged" />
                                    <Button
                                        x:Name="DirectionCheckButton"
                                        Grid.Row="0"
                                        Grid.Column="2"
                                        Width="70"
                                        Height="32"
                                        Margin="0,0,0,8"
                                        Click="DirectionCheckButton_Click"
                                        Content="Check"
                                        FontSize="10"
                                        Style="{StaticResource CustomActionButtonStyle}" />

                                    <TextBlock
                                        Grid.Row="1"
                                        Grid.Column="0"
                                        Margin="0,0,10,8"
                                        Style="{StaticResource CustomTextBlock}"
                                        Text="Left tag" />
                                    <ComboBox
                                        x:Name="LeftTagTypeComboBox"
                                        Grid.Row="1"
                                        Grid.Column="1"
                                        Grid.ColumnSpan="2"
                                        Margin="0,0,0,8"
                                        DisplayMemberPath="DisplayName"
                                        ItemsSource="{Binding LeftTagTypes}"
                                        Style="{StaticResource DarkThemeComboBox}" />

                                    <TextBlock
                                        Grid.Row="2"
                                        Grid.Column="0"
                                        Margin="0,0,10,8"
                                        Style="{StaticResource CustomTextBlock}"
                                        Text="Right tag" />
                                    <ComboBox
                                        x:Name="RightTagTypeComboBox"
                                        Grid.Row="2"
                                        Grid.Column="1"
                                        Grid.ColumnSpan="2"
                                        Margin="0,0,0,8"
                                        DisplayMemberPath="DisplayName"
                                        ItemsSource="{Binding RightTagTypes}"
                                        Style="{StaticResource DarkThemeComboBox}" />

                                    <TextBlock
                                        Grid.Row="3"
                                        Grid.Column="0"
                                        Margin="0,0,10,8"
                                        Style="{StaticResource CustomTextBlock}"
                                        Text="Up tag" />
                                    <ComboBox
                                        x:Name="UpTagTypeComboBox"
                                        Grid.Row="3"
                                        Grid.Column="1"
                                        Grid.ColumnSpan="2"
                                        Margin="0,0,0,8"
                                        DisplayMemberPath="DisplayName"
                                        ItemsSource="{Binding UpTagTypes}"
                                        Style="{StaticResource DarkThemeComboBox}" />

                                    <TextBlock
                                        Grid.Row="4"
                                        Grid.Column="0"
                                        Margin="0,0,10,0"
                                        Style="{StaticResource CustomTextBlock}"
                                        Text="Down tag" />
                                    <ComboBox
                                        x:Name="DownTagTypeComboBox"
                                        Grid.Row="4"
                                        Grid.Column="1"
                                        Grid.ColumnSpan="2"
                                        DisplayMemberPath="DisplayName"
                                        ItemsSource="{Binding DownTagTypes}"
                                        Style="{StaticResource DarkThemeComboBox}" />
                                </Grid>
                            </Expander>

                            <!--  Placement Options Card  -->
                            <Expander
                                x:Name="PlacementOptionsExpander"
                                Collapsed="CardExpander_Toggled"
                                Expanded="CardExpander_Toggled"
                                Header="Placement options"
                                IsExpanded="True"
                                Style="{StaticResource CollapsibleCardExpander}">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="0.5*" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>

                                    <!--  Column 1: Direction Checkboxes  -->
                                    <StackPanel
                                        Grid.Row="0"
                                        Grid.Column="0"
                                        Margin="0,0,10,0"
                                        VerticalAlignment="Top">
                                        <TextBlock
                                            Margin="0,0,0,8"
                                            FontWeight="Bold"
                                            Style="{StaticResource CustomTextBlock}"
                                            Text="Direction" />

                                        <CheckBox
                                            x:Name="PlacementUpCheckBox"
                                            Margin="0,0,0,4"
                                            Checked="PlacementDirection_Checked"
                                            Content="Up"
                                            Style="{StaticResource CustomCheckboxStyle}">
                                            <CheckBox.LayoutTransform>
                                                <ScaleTransform ScaleX="0.85" ScaleY="0.85" />
                                            </CheckBox.LayoutTransform>
                                        </CheckBox>

                                        <CheckBox
                                            x:Name="PlacementDownCheckBox"
                                            Margin="0,0,0,4"
                                            Checked="PlacementDirection_Checked"
                                            Content="Down"
                                            Style="{StaticResource CustomCheckboxStyle}">
                                            <CheckBox.LayoutTransform>
                                                <ScaleTransform ScaleX="0.85" ScaleY="0.85" />
                                            </CheckBox.LayoutTransform>
                                        </CheckBox>

                                        <CheckBox
                                            x:Name="PlacementLeftCheckBox"
                                            Margin="0,0,0,4"
                                            Checked="PlacementDirection_Checked"
                                            Content="Left"
                                            Style="{StaticResource CustomCheckboxStyle}">
                                            <CheckBox.LayoutTransform>
                                                <ScaleTransform ScaleX="0.85" ScaleY="0.85" />
                                            </CheckBox.LayoutTransform>
                                        </CheckBox>

                                        <CheckBox
                                            x:Name="PlacementRightCheckBox"
                                            Checked="PlacementDirection_Checked"
                                            Content="Right"
                                            Style="{StaticResource CustomCheckboxStyle}">
                                            <CheckBox.LayoutTransform>
                                                <ScaleTransform ScaleX="0.85" ScaleY="0.85" />
                                            </CheckBox.LayoutTransform>
                                        </CheckBox>
                                    </StackPanel>

                                    <!--  Column 2: Anchor Point Selection  -->
                                    <StackPanel
                                        Grid.Row="0"
                                        Grid.Column="1"
                                        Margin="0,0,10,0"
                                        VerticalAlignment="Top">
                                        <TextBlock
                                            Margin="0,0,0,8"
                                            FontWeight="Bold"
                                            Style="{StaticResource CustomTextBlock}"
                                            Text="Anchor" />

                                        <Grid Width="100" Height="100">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="*" />
                                                <RowDefinition Height="*" />
                                                <RowDefinition Height="*" />
                                            </Grid.RowDefinitions>
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="*" />
                                                <ColumnDefinition Width="*" />
                                            </Grid.ColumnDefinitions>

                                            <!--  Background Rectangle  -->
                                            <Border
                                                Grid.RowSpan="3"
                                                Grid.ColumnSpan="3"
                                                Background="{DynamicResource SecondaryBackgroundBrush}"
                                                BorderBrush="{DynamicResource BorderBrush}"
                                                BorderThickness="1"
                                                CornerRadius="4" />

                                            <!--  Top Row  -->
                                            <RadioButton
                                                x:Name="AnchorTopLeftRadio"
                                                Grid.Row="0"
                                                Grid.Column="0"
                                                HorizontalAlignment="Left"
                                                VerticalAlignment="Top"
                                                Checked="AnchorPoint_Checked"
                                                GroupName="AnchorPoint">
                                                <RadioButton.LayoutTransform>
                                                    <ScaleTransform ScaleX="0.9" ScaleY="0.9" />
                                                </RadioButton.LayoutTransform>
                                            </RadioButton>

                                            <RadioButton
                                                x:Name="AnchorTopCenterRadio"
                                                Grid.Row="0"
                                                Grid.Column="1"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Top"
                                                Checked="AnchorPoint_Checked"
                                                GroupName="AnchorPoint">
                                                <RadioButton.LayoutTransform>
                                                    <ScaleTransform ScaleX="0.9" ScaleY="0.9" />
                                                </RadioButton.LayoutTransform>
                                            </RadioButton>

                                            <RadioButton
                                                x:Name="AnchorTopRightRadio"
                                                Grid.Row="0"
                                                Grid.Column="2"
                                                HorizontalAlignment="Right"
                                                VerticalAlignment="Top"
                                                Checked="AnchorPoint_Checked"
                                                GroupName="AnchorPoint">
                                                <RadioButton.LayoutTransform>
                                                    <ScaleTransform ScaleX="0.9" ScaleY="0.9" />
                                                </RadioButton.LayoutTransform>
                                            </RadioButton>

                                            <!--  Middle Row  -->
                                            <RadioButton
                                                x:Name="AnchorLeftCenterRadio"
                                                Grid.Row="1"
                                                Grid.Column="0"
                                                HorizontalAlignment="Left"
                                                VerticalAlignment="Center"
                                                Checked="AnchorPoint_Checked"
                                                GroupName="AnchorPoint">
                                                <RadioButton.LayoutTransform>
                                                    <ScaleTransform ScaleX="0.9" ScaleY="0.9" />
                                                </RadioButton.LayoutTransform>
                                            </RadioButton>

                                            <RadioButton
                                                x:Name="AnchorCenterRadio"
                                                Grid.Row="1"
                                                Grid.Column="1"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Center"
                                                Checked="AnchorPoint_Checked"
                                                GroupName="AnchorPoint"
                                                IsChecked="True">
                                                <RadioButton.LayoutTransform>
                                                    <ScaleTransform ScaleX="0.9" ScaleY="0.9" />
                                                </RadioButton.LayoutTransform>
                                            </RadioButton>

                                            <RadioButton
                                                x:Name="AnchorRightCenterRadio"
                                                Grid.Row="1"
                                                Grid.Column="2"
                                                HorizontalAlignment="Right"
                                                VerticalAlignment="Center"
                                                Checked="AnchorPoint_Checked"
                                                GroupName="AnchorPoint">
                                                <RadioButton.LayoutTransform>
                                                    <ScaleTransform ScaleX="0.9" ScaleY="0.9" />
                                                </RadioButton.LayoutTransform>
                                            </RadioButton>

                                            <!--  Bottom Row  -->
                                            <RadioButton
                                                x:Name="AnchorBottomLeftRadio"
                                                Grid.Row="2"
                                                Grid.Column="0"
                                                HorizontalAlignment="Left"
                                                VerticalAlignment="Bottom"
                                                Checked="AnchorPoint_Checked"
                                                GroupName="AnchorPoint">
                                                <RadioButton.LayoutTransform>
                                                    <ScaleTransform ScaleX="0.9" ScaleY="0.9" />
                                                </RadioButton.LayoutTransform>
                                            </RadioButton>

                                            <RadioButton
                                                x:Name="AnchorBottomCenterRadio"
                                                Grid.Row="2"
                                                Grid.Column="1"
                                                HorizontalAlignment="Center"
                                                VerticalAlignment="Bottom"
                                                Checked="AnchorPoint_Checked"
                                                GroupName="AnchorPoint">
                                                <RadioButton.LayoutTransform>
                                                    <ScaleTransform ScaleX="0.9" ScaleY="0.9" />
                                                </RadioButton.LayoutTransform>
                                            </RadioButton>

                                            <RadioButton
                                                x:Name="AnchorBottomRightRadio"
                                                Grid.Row="2"
                                                Grid.Column="2"
                                                HorizontalAlignment="Right"
                                                VerticalAlignment="Bottom"
                                                Checked="AnchorPoint_Checked"
                                                GroupName="AnchorPoint">
                                                <RadioButton.LayoutTransform>
                                                    <ScaleTransform ScaleX="0.9" ScaleY="0.9" />
                                                </RadioButton.LayoutTransform>
                                            </RadioButton>
                                        </Grid>
                                    </StackPanel>

                                    <!--  Column 3: Leader  -->
                                    <StackPanel
                                        Grid.Row="0"
                                        Grid.Column="2"
                                        Margin="0,0,10,0"
                                        VerticalAlignment="Top">
                                        <TextBlock
                                            Margin="0,0,0,8"
                                            FontWeight="Bold"
                                            Style="{StaticResource CustomTextBlock}"
                                            Text="Leader" />

                                        <ComboBox
                                            x:Name="LeaderTypeComboBox"
                                            Margin="0,0,0,4"
                                            DisplayMemberPath="Name"
                                            ItemsSource="{Binding LeaderTypes}"
                                            Style="{StaticResource DarkThemeComboBox}" />

                                        <Grid Margin="0,0,0,4">
                                            <TextBox
                                                x:Name="LeaderLengthTextBox"
                                                Padding="5,0,23,0"
                                                HorizontalAlignment="Stretch"
                                                materialDesign:HintAssist.Hint="Length"
                                                Style="{StaticResource CustomTextBoxStyle}"
                                                Text="0"
                                                TextAlignment="Center" />
                                            <TextBlock
                                                Margin="0,0,8,0"
                                                HorizontalAlignment="Right"
                                                VerticalAlignment="Center"
                                                Foreground="{DynamicResource ForegroundBrush}"
                                                IsHitTestVisible="False"
                                                Text="mm" />
                                        </Grid>

                                        <CheckBox
                                            x:Name="LeaderLineCheckBox"
                                            Checked="LeaderLineCheckBox_Toggled"
                                            Content="Enabled"
                                            IsChecked="True"
                                            Style="{StaticResource CustomCheckboxStyle}"
                                            Unchecked="LeaderLineCheckBox_Toggled">
                                            <CheckBox.LayoutTransform>
                                                <ScaleTransform ScaleX="0.85" ScaleY="0.85" />
                                            </CheckBox.LayoutTransform>
                                        </CheckBox>
                                    </StackPanel>

                                    <!--  Column 4: Orientation  -->
                                    <StackPanel
                                        Grid.Row="0"
                                        Grid.Column="3"
                                        VerticalAlignment="Top">
                                        <TextBlock
                                            Margin="0,0,0,8"
                                            FontWeight="Bold"
                                            Style="{StaticResource CustomTextBlock}"
                                            Text="Orientation" />

                                        <ComboBox
                                            x:Name="OrientationComboBox"
                                            Margin="0,0,0,4"
                                            DisplayMemberPath="Name"
                                            ItemsSource="{Binding OrientationOptions}"
                                            Style="{StaticResource DarkThemeComboBox}" />

                                        <Grid Margin="0,0,0,4">
                                            <TextBox
                                                x:Name="AngleTextBox"
                                                Padding="5,0,18,0"
                                                HorizontalAlignment="Stretch"
                                                materialDesign:HintAssist.Hint="Angle"
                                                Style="{StaticResource CustomTextBoxStyle}"
                                                Text="0"
                                                TextAlignment="Center" />
                                            <TextBlock
                                                Margin="0,0,8,0"
                                                HorizontalAlignment="Right"
                                                VerticalAlignment="Center"
                                                Foreground="{DynamicResource ForegroundBrush}"
                                                IsHitTestVisible="False"
                                                Text="Â°" />
                                        </Grid>

                                        <CheckBox
                                            x:Name="DetectRotationCheckBox"
                                            Content="Detect Rotation"
                                            IsChecked="False"
                                            Style="{StaticResource CustomCheckboxStyle}">
                                            <CheckBox.LayoutTransform>
                                                <ScaleTransform ScaleX="0.85" ScaleY="0.85" />
                                            </CheckBox.LayoutTransform>
                                        </CheckBox>
                                    </StackPanel>
                                </Grid>
                            </Expander>

                            <!--  Execution Card - Collision Detection  -->
                            <Expander
                                x:Name="CollisionDetectionExpander"
                                Collapsed="CardExpander_Toggled"
                                Expanded="CardExpander_Toggled"
                                Header="Collision Detection"
                                Style="{StaticResource CollapsibleCardExpander}">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="150" />
                                        <ColumnDefinition Width="*" />
                                    </Grid.ColumnDefinitions>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>

                                    <TextBlock
                                        Grid.Row="0"
                                        Grid.Column="0"
                                        Margin="0,0,10,8"
                                        Style="{StaticResource CustomTextBlock}"
                                        Text="Avoid collisions" />
                                    <CheckBox
                                        x:Name="CollisionDetectionCheckBox"
                                        Grid.Row="0"
                                        Grid.Column="1"
                                        Margin="0,0,0,8"
                                        Checked="CollisionDetectionCheckBox_Toggled"
                                        Content="Enabled"
                                        IsChecked="False"
                                        Style="{StaticResource CustomCheckBox}"
                                        Unchecked="CollisionDetectionCheckBox_Toggled" />

                                    <TextBlock
                                        Grid.Row="1"
                                        Grid.Column="0"
                                        Margin="0,0,10,8"
                                        Style="{StaticResource CustomTextBlock}"
                                        Text="Gap (mm)" />
                                    <TextBox
                                        x:Name="CollisionGapTextBox"
                                        Grid.Row="1"
                                        Grid.Column="1"
                                        Width="200"
                                        Margin="0,0,0,8"
                                        HorizontalAlignment="Left"
                                        materialDesign:HintAssist.Hint="Gap in millimeters"
                                        IsEnabled="False"
                                        Style="{StaticResource CustomTextBoxStyle}"
                                        Text="1" />

                                    <TextBlock
                                        Grid.Row="2"
                                        Grid.Column="0"
                                        Margin="0,0,10,0"
                                        Style="{StaticResource CustomTextBlock}"
                                        Text="Minimum offset (mm)" />
                                    <TextBox
                                        x:Name="MinimumOffsetTextBox"
                                        Grid.Row="2"
                                        Grid.Column="1"
                                        Width="200"
                                        HorizontalAlignment="Left"
                                        materialDesign:HintAssist.Hint="Offset when no leader"
                                        Style="{StaticResource CustomTextBoxStyle}"
                                        Text="300" />
                                </Grid>
                            </Expander>

                            <!--  Retag / Normalize Card  -->
                            <Expander
                                x:Name="RetagNormalizeExpander"
                                Collapsed="CardExpander_Toggled"
                                Expanded="CardExpander_Toggled"
                                Header="Retag / Normalize"
                                Style="{StaticResource CollapsibleCardExpander}">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                        <RowDefinition Height="Auto" />
                                    </Grid.RowDefinitions>

                                    <TextBlock
                                        Grid.Row="0"
                                        Margin="0,0,0,6"
                                        FontSize="11"
                                        Style="{StaticResource CustomTextBlock}"
                                        Text="Execution mode" />

                                    <StackPanel Grid.Row="1" Margin="0,0,0,10">
                                        <CheckBox
                                            x:Name="RetagFullyAutomaticCheckBox"
                                            Margin="0,0,0,4"
                                            Checked="RetagExecutionMode_Changed"
                                            Content="Fully automatic"
                                            IsChecked="True"
                                            Style="{StaticResource CustomCheckboxStyle}">
                                            <CheckBox.LayoutTransform>
                                                <ScaleTransform ScaleX="0.85" ScaleY="0.85" />
                                            </CheckBox.LayoutTransform>
                                        </CheckBox>
                                        <CheckBox
                                            x:Name="RetagUserConfirmationCheckBox"
                                            Checked="RetagExecutionMode_Changed"
                                            Content="User confirmation"
                                            IsChecked="False"
                                            Style="{StaticResource CustomCheckboxStyle}">
                                            <CheckBox.LayoutTransform>
                                                <ScaleTransform ScaleX="0.85" ScaleY="0.85" />
                                            </CheckBox.LayoutTransform>
                                        </CheckBox>
                                    </StackPanel>

                                    <Grid Grid.Row="2">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="*" />
                                        </Grid.ColumnDefinitions>

                                        <Button
                                            Grid.Column="0"
                                            Height="30"
                                            Margin="0,0,4,0"
                                            Click="RetagSelectedButton_Click"
                                            Content="Retag Selected"
                                            FontSize="11"
                                            Style="{StaticResource CustomActionButtonStyle}" />

                                        <Button
                                            Grid.Column="1"
                                            Height="30"
                                            Margin="4,0,0,0"
                                            Click="NormalizeViewButton_Click"
                                            Content="Normalize View"
                                            FontSize="11"
                                            Style="{StaticResource CustomActionButtonStyle}" />
                                    </Grid>
                                </Grid>
                            </Expander>
                        </StackPanel>
                    </ScrollViewer>

                    <!--  Bottom Action Buttons  -->
                    <StackPanel
                        Grid.Row="2"
                        Margin="0,10,0,0"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Orientation="Horizontal">
                        <Button
                            x:Name="ActiveSelectionToggleButton"
                            Width="140"
                            Height="32"
                            Margin="0,0,8,0"
                            Click="ActiveSelectionToggle_Click"
                            Content="Start Active Selection"
                            FontSize="11"
                            Style="{StaticResource CustomActionButtonStyle}" />
                        <CheckBox
                            x:Name="SkipIfTaggedCheckBox"
                            Margin="0,0,15,0"
                            VerticalAlignment="Center"
                            Content="Skip if already tagged"
                            IsChecked="True"
                            Style="{StaticResource CustomCheckboxStyle}">
                            <CheckBox.LayoutTransform>
                                <ScaleTransform ScaleX="0.85" ScaleY="0.85" />
                            </CheckBox.LayoutTransform>
                        </CheckBox>
                        <Button
                            Width="110"
                            Height="32"
                            Margin="0,0,8,0"
                            Click="TagAllButton_Click"
                            Content="Tag all"
                            FontSize="12"
                            FontWeight="Bold"
                            Style="{StaticResource CustomActionButtonStyle}" />
                        <Button
                            Width="110"
                            Height="32"
                            Margin="0,0,8,0"
                            Click="TagSelectedButton_Click"
                            Content="Tag Selected"
                            FontSize="12"
                            FontWeight="Bold"
                            Style="{StaticResource CustomActionButtonStyle}" />
                    </StackPanel>
                </Grid>
            </Grid>
        </Border>
    </Grid>
</Window>
